---
counter: True
---

# x86 汇编语言

!!! abstract 

    - 自学，看书《汇编语言（第4版）》王爽
    - 浙江大学白洪欢老师 “汇编语言”（大一春夏）课程

## 基础知识

??? note "一些仅供了解的东西"

    - 机器语言：机器指令（二进制数）的集合
    - CPU 可以执行机器指令，进行运算
    - 汇编语言主体是汇编指令，汇编指令通过编译器编译为机器码给计算机执行
    - 寄存器：CPU 中可以存储数据的器件
    - 汇编语言组成：
        - 汇编指令：有对应的机器码，是机器码的助记符
        - 伪指令：由编译器执行，没有对应机器码
        - 其他符号（+-*/等）：由编译器识别，没有对应机器码 
    - 指令和数据在内存中存放，被 CPU 使用
    - 指令和数据在内存中没有区别，都是二进制信息
    - 计算机最小信息单位是 bit，8 个 bit 组成一个 Byte，一个存储单元可以存储一个 Byte（8 个二进制位），存储单元从 0 开始编号
    - CPU 通过总线与存储器芯片传输地址、数据、控制信息（总线：连接 CPU 和其他芯片的一堆导线）
    - CPU 从内存读取数据的过程：
        - CPU 通过地址线将地址信息发出
        - CPU 通过控制线发出内存读命令，告知指定存储器芯片要从中读取数据
        - 存储器将所需地址处的数据通过数据线送给 CPU
    - CPU 通过**地址总线**指定存储单元。地址总线上能传送多少个不同的信息，CPU 就可以对多少个存储单元进行寻址
    - **一个 CPU 有 n 根地址线，则这个 CPU 的地址总线宽度为 n，这样的 CPU 最多可以寻找 2<sup>n</sup> 个内存单元**
    - CPU 通过**数据总线**来与内存或其他器件之间传送数据。数据总线的宽度决定了 CPU 与外界的数据传送速度
    - **8 根数据总线一次可以传送一个 8 为二进制数据（1 个字节），16 根数据总线一次可以传送两个字节**
    - 8088 CPU 的数据总线宽度为 8，8086 CPU 的数据总线宽度为 16
    - CPU 通过控制总线对外部器件进行控制。控制总线的宽度决定了 CPU 对外部器件的控制能力
    - 主板上器件通过总线和 CPU 相连
    - CPU 通过插在扩展插槽上的接口卡间接控制外设
    - 存储器芯片从读写上分为 随机存储器（RAM）和 只读存储器（ROM）
        - RAM 可读可写，但必须带电存储，关机后内容丢失
        - ROM 只读不写，但关机后内容不丢失
    - 存储器从功能和连接上分为：
        - 随机存储器：存放供 CPU 使用的绝大部分程序和数据，由装在主板上的 RAM 和插在扩展插槽上的 RAM 组成 
        - 装有 BIOS 的 ROM：厂商提供的软件系统，通过它利用该硬件设备进行最基本的输入输出
        - 接口卡上的 RAM：某些接口卡需要对大批量输入、输出数据进行暂时存储，在其上装有 RAM（如显存）
    - CPU 在操控存储器的时候，把它们当作内存来对待，把它们总的看作一个由若干存储单元组成的逻辑存储器，即内存地址空间
    - 所有物理存储器被看作一个由若干存储单元组成的逻辑存储器，每个物理存储器在其中占有一个地址段，即地址空间

### 数据的表示与组织

二进制数末尾用 B/b 作后缀，十六进制末尾用 H/h 作后缀且如果开头为字母则要在前面加一个 0，八进制末尾用 Q/q 作后缀，十进制不用后缀

一个二进制位叫一位（bit），四个位叫一个半字节（nibble），八个位叫一个字节（byte），十六个位叫一个字（word），三十二个位叫一个双字（double word）

字符可以直接使用单引号括字符来表示，也可以用对应 ASCII 码来表示

### 内部寄存器

8086 内部一共有 14 个 16 位寄存器，8 个通用寄存器，4 个段寄存器，2 个控制寄存器

- 通用寄存器
    - 数据寄存器：ax bx cx dx，用于存放数据。每个寄存器为 16 位，可分为高低 8 位，高 8 位分别为 ah bh ch dh，低八位分别为 al bl cl dl，且如果只修改八位，则不会影响到另外八位（比如溢出不会从 al 溢出到 ah）
        - ax：累加器，常用作累加，且在乘除法、串运算、IO 中有专门用处
        - bx：基址寄存器，常用来存放寻址的基址
        - cx：计数寄存器，常用在循环中作为计数器
        - dx：数据寄存器，存放 IO 端口地址，且在双字运算中作为 ax 的扩展高十六位
    - 变址寄存器：si di，常用来寻址
        - si：源变址寄存器
        - di：目的变址寄存器
    - 指针寄存器：sp bp，常与 ss 构成远指针
        - sp：堆栈指针寄存器，ss:sp 指向堆栈顶端
        - bp：基址指针寄存器，常用 ss:bp 指向堆栈中数据
- 段寄存器：cs ss ds es
    - cs：代码段寄存器，存放代码段的段地址
    - ss：堆栈段寄存器，存放堆栈段的段地址
    - ds：数据段寄存器，存放数据段的段地址
    - es：附加数据段寄存器，存放附加数据段段地址
- 控制寄存器：ip fl
    - ip：指令指针寄存器，存放代码段的偏移地址， cs:ip 指向下一条指令的首字节，不能直接访问 ip
    - fl：标志寄存器，16 位但只使用 9 位表示 6 个状态标志和 3 个控制标志（df if tf）
        - of：overflow flag 溢出标志，第 11 位，表示运算是否溢出
        - df：direction flag 方向标志，第 10 位，标志字符串处理指令中处理信息的方向
        - if：interrupt flag 中断标志，第 9 位，是否允许外部硬件中断
        - tf：trace flag 跟踪标志，第 8 位，CPU 是否进入单步工作状态
        - sf：sign flag 符号标志，第 7 位，运算结果的符号（1 表示负）
        - zf：zero flag 零标志，第 6 位，运算结果是否为 0
        - af：auxiliary carry flag 辅助进位标志，第 4 位，记录运算时第三位是否向左侧产生进借位
        - pf：parity flag 奇偶标志，第 2 位，结果操作数中低 8 位 1 的个数是否为偶数
        - cf：carry flag 进位标志，第 1 位，运算时最高位是否向左侧有进借位

80386 32 位寄存器一共有 16 个

- 通用寄存器
    - eax ebx ecx edx，可以使用例如 ax 表示低 16 位，ah al 分别表示低 16 位中的高低 8 位
    - esi edi，低 16 位为 si di
    - esp ebp，低 16 位为 sp bp
- 段寄存器：cs ss ds es fs gs（多了两个附加数据段寄存器）
- 控制寄存器：eip eflags

### 8086 内存组织

可访问的内存一共有 1MB，十六进制表示为 00000h~FFFFFh，这样用 20 位表示的地址称为物理地址

寻址时使用的是 段地址:偏移地址 形式的逻辑地址，对应的物理地址为 段地址*16+偏移地址，汇编里写成 段地址:[偏移地址]。同样也容易看出一个存储单元对应的逻辑地址表示并不唯一

### 指令系统与寻址方式

汇编指令一般由操作码（opcode）和操作数（operand）构成，任何指令都有操作码，操作数的个数不一定

#### 操作数寻址方式

- **立即数方式**：即操作数为常数
- **寄存器方式**：以寄存器为操作数
- **直接寻址**：通过逻辑地址表示操作数，且偏移地址为立即数，比如 [1234h]、ss:[1234h]，省略情况默认 ds
- **间接寻址**：逻辑地址的偏移地址以间接形式表示，方括号内只能是 bx bp si di，且表示为 基址寄存器（bx bp 选其一或没有）+ 变址寄存器（si di 选其一或没有）+ 位移量（立即数或没有）的形式  
    即 bx bp 不能同时出现，si di 不能同时出现  
    省略段地址时，如果偏移地址内有 bp 出现，则缺省段地址为 ss，其它情况均为 ds  
    段地址不能是立即数，一般除 cs ss ds 外的其它段地址预先存在 es 中再寻址

## 8086 汇编指令

### 数据传送指令

<div class="card" markdown="1">

<div class="card-header">mov</div>

<div class="card-body" markdown="1">

- **指令格式**：mov a, b
- **指令作用**：将 b 的值传入 a
- **注意**：a 是寄存器或者逻辑地址，b 可以是寄存器、逻辑地址或立即数，但 a b 最多有一个是逻辑地址，且如果是将立即数传入逻辑地址所指内存时要标注大小（byte ptr / word ptr）

</div>

</div>

### 转换指令

### 算数指令

### 十进制调整指令

### 字符串操作指令

### 控制转移指令


## 8086 汇编程序格式